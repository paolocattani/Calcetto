(this.webpackJsonpcalcetto=this.webpackJsonpcalcetto||[]).push([[13],{1311:function(e,t,a){"use strict";var n=a(5),r=a(11),c=a(14),o=a.n(c),s=a(0),i=a.n(s),l=a(111),u=function(){},d=i.a.forwardRef((function(e,t){var a=e.children,c=e.name,d=e.className,b=e.checked,j=e.type,m=e.onChange,f=e.value,g=e.disabled,p=e.inputRef,h=Object(r.a)(e,["children","name","className","checked","type","onChange","value","disabled","inputRef"]),O=Object(s.useState)(!1),v=O[0],x=O[1],N=Object(s.useCallback)((function(e){"INPUT"===e.target.tagName&&x(!0)}),[]),w=Object(s.useCallback)((function(e){"INPUT"===e.target.tagName&&x(!1)}),[]);return i.a.createElement(l.a,Object(n.a)({},h,{ref:t,className:o()(d,v&&"focus",g&&"disabled"),type:void 0,active:!!b,as:"label"}),i.a.createElement("input",{name:c,type:j,value:f,ref:p,autoComplete:"off",checked:!!b,disabled:!!g,onFocus:N,onBlur:w,onChange:m||u}),a)}));d.displayName="ToggleButton",t.a=d},1328:function(e,t,a){"use strict";a.r(t);var n=a(15),r=a(7),c=a(2),o=a(24),s=a(0),i=a(40),l=a(341),u=a.n(l),d=a(49),b=a(202),j=a(152),m=a(111),f=a(299),g=a(1311),p=a(10),h=a(75),O=a(8),v=a.n(O),x=a(76),N=a(307),w=a(423),S=a.n(w),C=function(e){var t=e.title,a=e.saved,n={color:a?"#4feb34":void 0};return Object(c.jsxs)("h3",{children:[Object(c.jsxs)("b",{style:n,children:["Girone - ",Object(c.jsx)("strong",{children:t})]}),a?Object(c.jsx)("small",{children:" - Salvataggio in corso..."}):null]})},k=a(428),y=a.n(k);function I(e,t){return e.total===t.total?3===e["col".concat(t.rowNumber)]||2===e["col".concat(t.rowNumber)]?-1:1:t.total-e.total}var T=a(108),P=a(90),R=function(e,t,a,r,c,o,s){return y()({mode:e?"click":"none",blurToSave:!0,beforeSaveCell:function(e,t,a,n){n.id.startsWith("col")&&(r[parseInt(n.text)-1]["col".concat(a.rowNumber)]=function(e){if(null===e)return null;switch(parseInt(e)){case 3:return 0;case 2:return 1;case 1:return 2;case 0:return 3;default:return null}}(t))},afterSaveCell:function(e,i,l,u){var d=Object(n.a)(r);if(u.id.startsWith("col")){Object(T.b)({tId:l.pair.tournamentId,stageName:t,score:i,pair1Id:l.pair.id,pair2Id:r[parseInt(u.text)-1].pair.id}).then((function(e){P.b.includes(e.code)&&(s(!0),setTimeout((function(){return s(!1)}),3e3))}));var b=0;for(var j in l)j.startsWith("col")&&l[j]&&(b+=parseInt(l[j]));var m=l.rowNumber-1,f=d[m];f.total=b||0,b=0;var g=parseInt(u.text)-1;for(var p in d[g])p.startsWith("col")&&d[g][p]&&(b+=parseInt(d[g][p]));var h=d[g];h.total=b||0,d.splice(m,1,f),d.splice(g,1,h)}a&&Object(n.a)(d).sort((function(e,t){return I(e,t)})).forEach((function(e,t){return d[e.rowNumber-1].placement=t+1})),c(d),o({rows:r.map((function(e){return{id:e.pair.id,placement:e.placement}}))})}})},A={headerAlign:"center"},B={align:"center"},E=function(e,t){return Object(r.a)(Object(r.a)(Object(r.a)({id:"col".concat(e),dataField:"col".concat(e),text:e.toString(),headerStyle:function(e,a){return{width:"".concat(75/t,"%")}}},A),{},{editable:function(e,t,a,n){return a!==n-2}},B),{},{style:function(e,t,a,n){return a===n-2?{backgroundColor:"#343a40"}:3===parseInt(e,10)||2===parseInt(e,10)?{backgroundColor:"rgb(196, 247, 160)"}:1===parseInt(e,10)||0===parseInt(e,10)?{backgroundColor:"rgb(255, 147, 147)"}:null},editor:{type:k.Type.SELECT,options:[{value:"3",label:"3"},{value:"2",label:"2"},{value:"1",label:"1"},{value:"0",label:"0"},{value:null,label:""}]}})},_=function(e){for(var t=[Object(r.a)(Object(r.a)({id:"pairLabel",dataField:"pair.label",text:"Nome Coppia",editable:!1,headerStyle:function(e,t){return{width:"15%"}}},B),A),Object(r.a)(Object(r.a)({id:"rowNumber",dataField:"rowNumber",text:"ID",editable:!1,type:"number",headerStyle:function(e,t){return{width:"5%"}}},A),{},{style:function(e,t,a,n){return{backgroundColor:"#343a40",color:"#ffc107"}}})],a=0;a<e.length;a++)t.push(E(a+1,e.length));return t.push(Object(r.a)({id:"totale",dataField:"total",text:"Totale",editable:!1,type:"number",headerStyle:function(e,t){return{width:"5%"}}},A),Object(r.a)({id:"placement",dataField:"placement",text:"Posizione",editable:!0,type:"number",headerStyle:function(e,t){return{width:"5%"}}},A)),t},F=a(103),L=a(77),q=a(58),U=function(e){var t=e.pairsList,a=e.autoOrder,r=e.stageName,o=Object(i.d)(),l=Object(F.a)(h.d.getToogleRefresh),u=Object(F.a)(L.a.isAdmin),d=Object(F.a)(h.f.getTournament),b=Object(F.a)((function(e){return h.d.getSelectedRows(r,e)})),j=Object(s.useState)(!1),m=Object(N.a)(j,2),f=m[0],g=m[1],O=Object(s.useState)(!1),w=Object(N.a)(O,2),k=w[0],y=w[1],A=Object(s.useState)([]),B=Object(N.a)(A,2),E=B[0],U=B[1];Object(s.useEffect)((function(){Object(x.a)(v.a.mark((function e(){var c,o;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g(!0),e.next=3,Object(T.a)({pairsList:t,stageName:r});case 3:c=e.sent,P.b.includes(c.code)&&(o=c,a&&Object(n.a)(o.rows).sort((function(e,t){return I(e,t)})).forEach((function(e,t){return o.rows[e.rowNumber-1].placement=t+1})),U(o.rows)),g(!1);case 6:case"end":return e.stop()}}),e)})))()}),[t,l]);var W={mode:"checkbox",selected:b.map((function(e){return e.id})),onSelect:function(e,t){var a,c=!!b.find((function(t){return t.rowNumber===e.rowNumber}));return a=t?c?b:[].concat(Object(n.a)(b),[e]):c?b.filter((function(t){return t.rowNumber!==e.rowNumber})):b,o(p.d.updateSelectedPairs.request({stage1Name:r,stage1Rows:a,tournamentId:d.id})),!0},onSelectAll:function(e,t){o(p.d.updateSelectedPairs.request({stage1Name:r,stage1Rows:e?t:[],tournamentId:d.id}))},style:{backgroundColor:"#c8e6c9"},hideSelectColumn:!u||d.progress>=q.TournamentProgress.Stage2};return console.log("Refreshing : ",l),f?Object(c.jsxs)("h3",{children:["Caricamento girone ",Object(c.jsx)("b",{children:r})," in corso...."]}):Object(c.jsx)(S.a,{bootstrap4:!0,keyField:"id",data:E,columns:_(t),selectRow:W,cellEdit:R(u&&d.progress<q.TournamentProgress.Stage2,r,a,E,U,(function(e){return o(p.d.updatePlacement.request(e))}),y),noDataIndication:"Nessun dato reperito",headerClasses:"default-background default-color-yellow",caption:Object(c.jsx)(C,{title:r,saved:k}),striped:!0,hover:!0},"Stege1-".concat(r))},W=a(362);t.default=function(){var e=Object(o.g)(),t=Object(i.d)(),a=Object(F.a)(h.a.getSession),n=Object(F.a)(h.f.getTournament),s=Object(F.a)(h.d.getSelectedPairs),l=Object(F.a)(h.b.getPairsList);console.log("selected : ",s);var O=Object(c.jsxs)("div",{className:u.a.toolsBarContainer,children:[Object(c.jsxs)(b.a,{className:u.a.toolsBarRow,children:[Object(c.jsx)(j.a,{children:Object(c.jsxs)(m.a,{variant:"secondary",onClick:function(){e.push(a.isAdmin?"/tournament":"/")},className:"float-left",children:[Object(c.jsx)(d.j,{})," Indietro"]})}),n.progress>q.TournamentProgress.Stage1&&a.isAdmin?Object(c.jsx)(j.a,{children:Object(c.jsxs)(m.a,{variant:"danger",onClick:function(){t(p.e.delete.request({tId:n.id})),t(p.d.resetPairs({}))},disabled:!a.isAdmin||a.isAdmin&&n.progress<q.TournamentProgress.Stage2,children:[Object(c.jsx)(d.u,{})," Reset Fase 2"]})}):null,Object(c.jsx)(j.a,{children:Object(c.jsxs)(m.a,{variant:"outline-warning",className:"default-color-white float-right",onClick:function(){a.isAdmin&&n.progress<q.TournamentProgress.Stage2&&(n.progress=q.TournamentProgress.Stage2,t(p.g.update.request({tournament:n})));var r=8;if(s&&s.length>=4)for(r=s.length-1;r%8!==0;)r++;t(p.e.fetchStage2.request({tournamentId:n.id,count:r})),e.push("/stage2")},disabled:s.length<4&&n.progress<q.TournamentProgress.Stage2,children:[Object(c.jsx)("b",{children:"Prosegui "})," ",Object(c.jsx)(d.p,{})]})})]}),n.progress<=q.TournamentProgress.Stage1&&a.isAdmin?Object(c.jsx)(b.a,{children:Object(c.jsx)(j.a,{children:Object(c.jsx)(f.a,{toggle:!0,className:"mb-2",children:Object(c.jsx)(g.a,{type:"checkbox",variant:n.autoOrder?"success":"danger",checked:n.autoOrder,value:"1",onChange:function(e){return t(p.g.update.request({tournament:Object(r.a)(Object(r.a)({},n),{},{autoOrder:e.currentTarget.checked})}))},children:"Ordinamento automatico : ".concat(n.autoOrder?"Attivato ":" Disattivato")})})})}):null]});return Object(c.jsxs)(c.Fragment,{children:[O,Object(c.jsx)(W.a,{}),l?D(l,n.autoOrder):null]})};function D(e,t){var a="",r=[],o=[];return Object(n.a)(e).sort((function(e,t){return e.stage1Name.localeCompare(t.stage1Name)})).forEach((function(e,n){""===a&&(a=e.stage1Name),a!==e.stage1Name&&(o.push(Object(c.jsx)(U,{stageName:a,pairsList:r,autoOrder:t},"Stage1-".concat(a))),a=e.stage1Name,r=[]),r.push(e)})),r.length>0&&o.push(Object(c.jsx)(U,{stageName:a,pairsList:r,autoOrder:t},"Stage1-".concat(a))),o}},341:function(e,t,a){e.exports={functionsList:"common_functionsList__3B3UB",toolsBarContainer:"common_toolsBarContainer__1nanA",toolsBarRow:"common_toolsBarRow__r8q12"}},360:function(e,t,a){"use strict";function n(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}a.d(t,"a",(function(){return n}))},362:function(e,t,a){"use strict";var n=a(2),r=(a(0),a(75)),c=a(103),o=a(202),s=a(152),i=a(300),l=a(104),u=a(304);t.a=function(){var e=Object(c.a)(r.f.getTournament),t=Object(u.a)(["tournament"]).t;return Object(n.jsx)(o.a,{children:Object(n.jsx)(s.a,{children:Object(n.jsx)("h2",{className:"float-left",children:Object(n.jsxs)(i.a,{variant:"info",children:[Object(n.jsxs)("span",{children:[t("tournament:".concat(e.public?"public":"private","_tournament"))," "]}),Object(n.jsxs)("strong",{children:['"',e.name.toUpperCase(),'"']}),Object(n.jsx)("span",{children:Object(n.jsxs)("i",{children:[" - ".concat(Object(l.a)(e.date)," "),Object(n.jsxs)("small",{children:[" @ ",t("tournament:progress.".concat(e.progress))]}),null]})})]})})})})}}}]);
//# sourceMappingURL=13.de07358e.chunk.js.map
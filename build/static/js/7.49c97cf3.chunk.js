(this.webpackJsonpcalcetto=this.webpackJsonpcalcetto||[]).push([[7],{1277:function(e,t,r){"use strict";var a=r(2),n=r(8),c=r(12),s=r.n(c),i=r(0),o=r.n(i),l=r(101),u=function(){},p=o.a.forwardRef((function(e,t){var r=e.children,c=e.name,p=e.className,d=e.checked,b=e.type,f=e.onChange,j=e.value,m=e.disabled,h=e.inputRef,g=Object(n.a)(e,["children","name","className","checked","type","onChange","value","disabled","inputRef"]),O=Object(i.useState)(!1),x=O[0],y=O[1],v=Object(i.useCallback)((function(e){"INPUT"===e.target.tagName&&y(!0)}),[]),w=Object(i.useCallback)((function(e){"INPUT"===e.target.tagName&&y(!1)}),[]);return o.a.createElement(l.a,Object(a.a)({},g,{ref:t,className:s()(p,x&&"focus",m&&"disabled"),type:void 0,active:!!d,as:"label"}),o.a.createElement("input",{name:c,type:b,value:j,ref:h,autoComplete:"off",checked:!!d,disabled:!!m,onFocus:v,onBlur:w,onChange:f||u}),r)}));p.displayName="ToggleButton",t.a=p},1278:function(e,t,r){},1279:function(e,t,r){"use strict";var a=r(8),n=r(2),c=r(12),s=r.n(c),i=r(0),o=r.n(i),l=r(34),u=r(14),p=Object(l.a)("input-group-append"),d=Object(l.a)("input-group-prepend"),b=Object(l.a)("input-group-text",{Component:"span"}),f=o.a.forwardRef((function(e,t){var r=e.bsPrefix,c=e.size,i=e.className,l=e.as,p=void 0===l?"div":l,d=Object(a.a)(e,["bsPrefix","size","className","as"]);return r=Object(u.a)(r,"input-group"),o.a.createElement(p,Object(n.a)({ref:t},d,{className:s()(i,r,c&&r+"-"+c)}))}));f.displayName="InputGroup";var j=Object(n.a)({},f,{Text:b,Radio:function(e){return o.a.createElement(b,null,o.a.createElement("input",Object(n.a)({type:"radio"},e)))},Checkbox:function(e){return o.a.createElement(b,null,o.a.createElement("input",Object(n.a)({type:"checkbox"},e)))},Append:p,Prepend:d});t.a=j},1291:function(e,t,r){"use strict";r.r(t);var a=r(9),n=r(15),c=r(4),s=r.n(c),i=r(20),o=r(291),l=r(3),u=r(0),p=r.n(u),d=r(1279),b=r(312),f=r(101),j=r(184),m=r(142),h=r(397),g=r.n(h),O=r(24),x=r(39),y=r(22),v=r(61),w=r(288),k=function(e){var t=e.addRow,r=e.optionsLength,a=e.isEditable,n=Object(w.a)(["common","pair"]).t,c=r-1,s=c<8?8-c:0;return r?c>=8?Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)("p",{children:"".concat(n("pair:missing.1"),"...")}),Object(l.jsx)(f.a,{variant:"success",onClick:t,disabled:!a,children:n("pair:add.one")})]}):Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)("p",{children:n("pair:missing.2",{current:c,min:8})}),Object(l.jsx)("p",{children:"".concat(1===s?n("pair:missing.3"):n("pair:missing.4",{diff:s}),"...")}),Object(l.jsx)(v.b,{to:"/player",children:Object(l.jsx)(f.a,{variant:"success",children:n("common:root.player")})})]}):null},C=r(76),S=r(51),N=r(361),P=r.n(N),T=r(364),E=p.a.forwardRef((function(e,t){var r=e.styles,a=e.row,n=e.columnIndex,c=(e.onUpdate,e.onSelect),s=e.options,i=Object(u.useState)(),p=Object(o.a)(i,2),d=p[0],b=p[1];return Object(l.jsx)(T.a,{styles:r,options:s,onChange:function(e,t){b(e),c(e,a.id,n)},getOptionLabel:function(e){return e.alias},getOptionValue:function(e){var t;return null===(t=e.id)||void 0===t?void 0:t.toString(10)},value:d,placeholder:"Cerca...",isSearchable:!0,isClearable:!0})}));var I={option:function(e,t){return Object(a.a)(Object(a.a)({},e),{},{backgroundColor:"white",color:"black","&:hover":{backgroundColor:"#64bd9c",color:"white"}})},input:function(e){return Object(a.a)(Object(a.a)({},e),{},{backgroundColor:"#64bd9c"})},control:function(e){return Object(a.a)(Object(a.a)({},e),{},{height:"3vmin",marginBottom:"auto"})},singleValue:function(e){return Object(a.a)({},e)},valueContainer:function(e){return Object(a.a)(Object(a.a)({},e),{},{height:"100%",fontSize:"larger"})}},F=r(283),R=r(1277),B="center",L=function(e,t,r,n,c,s,i){return Object(l.jsx)(E,Object(a.a)(Object(a.a)({},e),{},{id:c,row:r,rowIndex:n,columnIndex:c,value:t,onSelect:s,options:i,styles:I}))},_={align:function(){return B},headerStyle:function(e,t){return{width:"7,5%"}},editor:{type:N.Type.CHECKBOX,value:"".concat("Si",":").concat("No")},formatter:function(e,t,r,a){return Object(l.jsx)(F.a,{toggle:!0,className:"mb-2",children:Object(l.jsx)(R.a,{variant:e?"success":"danger",checked:e,value:"1",type:"checkbox",children:e?"Pagato":"Non Pagato"})})}},M=function(e,t,r){return[{dataField:"id",text:"ID",editable:!1,hidden:!0,align:function(){return B}},{dataField:"rowNumber",text:"ID",editable:!1,align:function(){return B}},{dataField:"player1.alias",text:r.player1,align:function(){return B},editorRenderer:function(r,a,n,c,s,i){return L(r,a,n,s,i,e,t)},headerStyle:function(e,t){return{width:"20%"}}},{dataField:"player2.alias",text:r.player2,align:function(){return B},editorRenderer:function(r,a,n,c,s,i){return L(r,a,n,s,i,e,t)},headerStyle:function(e,t){return{width:"20%"}}},{dataField:"alias",text:r.alias,headerStyle:function(e,t){return{width:"25%"}}},{dataField:"stage1Name",text:r.stage1,align:function(){return B},headerStyle:function(e,t){return{width:"10%"}},editor:{type:N.Type.SELECT,options:"abcdefghijklmnopqrstuvwxyz".toUpperCase().split("").map((function(e){return{value:e,label:e}}))}},Object(a.a)({dataField:"paid1",text:"Pagato 1"},_),Object(a.a)({dataField:"paid2",text:"Pagato 2"},_)]},q=(r(1278),r(324)),U=r.n(q),A=r(64),z=r(71),D=r(143),J=r(13),H=r(345),K=r(59),V=r(63),G=r(32),X=r(344),Y={message:"",onClick:function(){return console.log("")},show:!1,title:""};t.default=Object(O.i)((function(){var e=Object(O.g)(),t=Object(x.c)(),r=Object(w.a)(["common","pair"]).t,c=Object(x.d)(z.a.isAdmin),p=Object(x.d)(D.a.getTournament),h=Object(u.useState)({state:!1,message:r(X.b)}),v=Object(o.a)(h,2),N=v[0],T=v[1],E=Object(u.useState)(Y),I=Object(o.a)(E,2),F=I[0],R=I[1],B=Object(u.useState)({rows:[],players:[]}),L=Object(o.a)(B,2),_=L[0],q=L[1],Q=Object(u.useState)([]),W=Object(o.a)(Q,2),Z=W[0],$=W[1],ee=Object(u.useState)(0),te=Object(o.a)(ee,2),re=te[0],ae=te[1],ne=Object(u.useState)(0),ce=Object(o.a)(ne,2),se=ce[0],ie=ce[1];function oe(e){T({state:!1,message:e}),y.b.error(e,{autoClose:1e4})}function le(e){T({state:!1,message:e}),y.b.success(e)}function ue(e){return pe.apply(this,arguments)}function pe(){return(pe=Object(i.a)(s.a.mark((function e(t){var c,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,T({state:!0,message:r(X.b)}),(c=Object(V.d)()).tournamentId=p.id||0,e.next=6,Object(V.e)({pair:c});case 6:i=e.sent,c.id=i.pair.id,c.rowNumber=t||_.rows.length+1,q((function(e){return{rows:[c].concat(Object(n.a)(e.rows)).map((function(e,t){return Object(a.a)(Object(a.a)({},e),{},{rowNumber:t+1})})),players:e.players}})),le(r("pair:success.add")),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),oe(r("pair:error.19"));case 16:case"end":return e.stop()}}),e,null,[[0,13]])})))).apply(this,arguments)}function de(){return(de=Object(i.a)(s.a.mark((function e(){var t,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=_.rows.length+1,r=0;case 2:if(!(r<se)){e.next=9;break}return e.next=5,ue(t);case 5:t++;case 6:r++,e.next=2;break;case 9:ie(0);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function be(){return(be=Object(i.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,T({state:!0,message:r(X.b)}),t=[],Z.forEach((function(e){e.player1&&e.player1.id&&t.push(e.player1),e.player2&&e.player2.id&&t.push(e.player2)})),e.next=6,Object(V.a)({pairsList:Z});case 6:q((function(e){return{rows:e.rows.filter((function(e){return!Z.find((function(t){return t.id===e.id}))})),players:t?[].concat(t,Object(n.a)(e.players)).sort((function(e,t){return e.alias.localeCompare(t.alias)})):e.players}})),le(r("pair:success.".concat(Z.length>1?"deleteMulti":"deleteOne"))),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),oe(r("pair:error.18"));case 13:$([]);case 14:case"end":return e.stop()}}),e,null,[[0,10]])})))).apply(this,arguments)}function fe(e,t){e&&e.id?t.id?q((function(r){return{rows:r.rows,players:[].concat(Object(n.a)(r.players.filter((function(e){return e.id!==t.id}))),[e]).sort((function(e,t){return e.alias.localeCompare(t.alias)}))}})):q((function(t){return{rows:t.rows,players:[].concat(Object(n.a)(t.players),[e]).sort((function(e,t){return e.alias.localeCompare(t.alias)}))}})):t.id&&q((function(e){return{rows:e.rows,players:e.players.filter((function(e){return e.id!==t.id}))}}))}Object(u.useEffect)((function(){p&&Object(i.a)(s.a.mark((function e(){var t,r,a,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(V.b)({tId:p.id});case 2:return t=e.sent,r=t.pairsList,e.next=6,Object(A.b)({addEmpty:!0,tId:p.id});case 6:a=e.sent,n=a.playersList,q({rows:r,players:n});case 9:case"end":return e.stop()}}),e)})))()}),[p]);var je=function(){var e=Object(i.a)(s.a.mark((function e(t,a,n){var c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(_.rows.map(function(){var e=Object(i.a)(s.a.mark((function e(c){var i,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c.id!==a){e.next=12;break}if(i=c,1===n?t.id&&i.player2&&i.player2.id===t.id?(i.player1=Object(A.c)(),oe(r("pair:error.17"))):(fe(i.player1,t),i.player1=t):t.id&&i.player1&&i.player1.id===t.id?(i.player2=Object(A.c)(),oe(r("pair:error.17"))):(fe(i.player2,t),i.player2=t),!(!i.alias&&i.player1&&i.player1.id&&i.player2&&i.player2.id)){e.next=8;break}return e.next=6,Object(V.c)({player1Id:i.player1.id,player2Id:i.player2.id});case 6:o=e.sent,i.alias=o.code===G.a.OK&&o.alias?o.alias:"";case 8:return Object(V.g)({pair:i}),e.abrupt("return",i);case 12:return e.abrupt("return",c);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:c=e.sent,q((function(e){return{rows:c,players:e.players}}));case 4:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),me=function(){var a=Object(i.a)(s.a.mark((function a(){var n,i,o,l,u;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(p.id||(oe("".concat(r("pair:error.16"),"...")),setTimeout((function(){return e.push("/")}),5e3)),!(_.rows.length<4)){a.next=4;break}return oe(r("pair:error.15")),a.abrupt("return");case 4:if(0===(n=_.rows.filter((function(e){return!e.stage1Name||""===e.stage1Name})).map((function(e){return e.rowNumber}))).length){a.next=8;break}return oe(r("pair:error.".concat(1===n.length?"13":"14"),{missingStage1Name:n})),a.abrupt("return");case 8:if(0===(i=_.rows.filter((function(e){return!e.player1||!e.player1.id||!e.player2||!e.player2.id})).map((function(e){return e.rowNumber}))).length){a.next=12;break}return oe(r("pair:error.".concat(1===i.length?"11":"12"),{missingPairs:i})),a.abrupt("return");case 12:for(u in 3,o=[],l=_.rows.reduce((function(e,t){return t.stage1Name in e?e[t.stage1Name]++:e[t.stage1Name]=1,e}),{}))l[u]<=3&&o.push(u);if(!(o.length>0)){a.next=19;break}return oe(r("pair:error.".concat(1===o.length?"9":"10"),{invalidStage:o,min:4})),a.abrupt("return");case 19:c&&p.progress<K.TournamentProgress.Stage1&&(p.progress=K.TournamentProgress.Stage1,t(J.f.update.request({tournament:p}))),t(J.b.fetch.request({tId:p.id})),e.push("/stage1");case 22:case"end":return a.stop()}}),a)})));return function(){return a.apply(this,arguments)}}();var he={mode:"checkbox",onSelect:function(e,t){return $((function(r){var a=!!r.find((function(t){return t.id===e.id}));return t?a?r:[e].concat(Object(n.a)(r)):a?r.filter((function(t){return t.id!==e.id})):r})),!0},onSelectAll:function(e,t){return $(e?t:[])},style:{backgroundColor:"#c8e6c9"},hideSelectColumn:!c||p.progress>K.TournamentProgress.PairsSelection},ge=function(){var e=Object(i.a)(s.a.mark((function e(){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,T({state:!0,message:r(X.b)}),e.next=4,fetch("/api/v1/stage1",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({tId:p.id})});case 4:return n=e.sent,e.next=7,n.json();case 7:c&&t(J.f.update.request({tournament:Object(a.a)(Object(a.a)({},p),{},{progress:K.TournamentProgress.PairsSelection})})),le(r("pair:success.delete")),R(Y),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),oe(r("pair:error.8"));case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(){return e.apply(this,arguments)}}();function Oe(){return(Oe=Object(i.a)(s.a.mark((function e(){var t,a,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(re){e.next=3;break}return oe(r("pair:error.6")),e.abrupt("return");case 3:if(!(p.progress>K.TournamentProgress.PairsSelection)){e.next=6;break}return oe(r("pair:error.5")),e.abrupt("return");case 6:T({state:!0,message:r(X.b)}),t="abcdefghijklmnopqrstuvwxyz".toUpperCase().split(""),a=0,n=_.rows.map((function(e){return a===re&&(a=0),e.stage1Name=t[a],a++,Object(V.e)({pair:e}),e})),le(r("pair:success.stage1Name")),q((function(e){return{rows:n,players:e.players}}));case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var xe,ye=Math.floor(Math.floor((_.players.length-1)/2)-(0===_.rows.length?0:_.rows.reduce((function(e,t){var r,a;return!t.player1&&!t.player2||!(null===(r=t.player1)||void 0===r?void 0:r.id)&&!(null===(a=t.player2)||void 0===a?void 0:a.id)?e+1:t.player1&&t.player1.id&&t.player2&&t.player2.id?e:e+.5}),0))),ve=Z.length<=0||p.progress>K.TournamentProgress.PairsSelection,we=Object(l.jsxs)(d.a,{children:[Object(l.jsx)(d.a.Prepend,{children:Object(l.jsx)(d.a.Text,{children:r("pair:stage1.set")})}),Object(l.jsx)(b.a,{placeholder:_.rows.length<4?r("pair:error.3"):r("pair:error.4",{max:Math.floor(_.rows.length/4)}),type:"number",step:1,min:0,max:Math.floor(_.rows.length/4),value:0!==re?re:void 0,onChange:function(e){return ae(Number(e.currentTarget.value))},disabled:_.rows.length<4||p.progress===K.TournamentProgress.Stage1||p.progress===K.TournamentProgress.Stage2}),Object(l.jsx)(d.a.Append,{children:Object(l.jsx)(f.a,{variant:"primary",onClick:function(){return Oe.apply(this,arguments)},disabled:!re||re>Math.floor(_.rows.length/4)||_.rows.length<4,children:r("common:exec")})})]}),ke=Object(l.jsxs)(d.a,{children:[Object(l.jsx)(d.a.Prepend,{children:Object(l.jsx)(d.a.Text,{children:r("pair:add.multi")})}),Object(l.jsx)(b.a,{disabled:ye<=0,type:"number",step:1,min:1,max:ye,placeholder:ye<=0?r("pair:error.1"):r("pair:error.2",{max:ye}),onChange:function(e){return ie(Number(e.currentTarget.value))},value:se||""}),Object(l.jsxs)(d.a.Append,{children:[Object(l.jsx)(f.a,{variant:"primary",onClick:function(e){return ie(ye)},disabled:se>ye,children:r("common:max")}),Object(l.jsx)(f.a,{variant:"primary",onClick:function(){return de.apply(this,arguments)},disabled:!se||se>ye,children:r("common:exec")})]})]}),Ce=Object(l.jsxs)("div",{className:U.a.toolsBarContainer,children:[Object(l.jsxs)(j.a,{className:U.a.toolsBar,children:[Object(l.jsx)(m.a,{children:Object(l.jsxs)(f.a,{variant:"secondary",className:"float-left align-middle",onClick:function(){e.push("/")},children:[Object(l.jsx)(S.f,{})," ",r("common:route.home")]})}),p.progress>K.TournamentProgress.PairsSelection?null:Object(l.jsx)(m.a,{children:Object(l.jsxs)(f.a,{variant:"success",className:"align-middle",onClick:function(){return ue()},disabled:ye<=0||!c,children:[Object(l.jsx)(S.k,{})," ",r("pair:add.one")]})}),p.progress>K.TournamentProgress.PairsSelection?null:Object(l.jsx)(m.a,{children:Object(l.jsxs)(f.a,{variant:"danger",className:"align-middle",onClick:function(){return be.apply(this,arguments)},disabled:ve||!c,children:[Object(l.jsx)(S.q,{})," ",1===Z.length?r("pair:delete.one"):r("pair:delete.multi")]})}),p.progress!==K.TournamentProgress.Stage1?null:Object(l.jsx)(m.a,{children:Object(l.jsx)(f.a,{variant:"danger",className:"align-middle",onClick:function(){p.progress>K.TournamentProgress.Stage1?oe(r("pair:error.7")):R({message:"".concat(r("pair:stage1.resetConfirm")," ?"),onClick:function(){return ge()},onHide:function(){return R(Y)},show:!0,title:r("pair:stage1.reset")})},disabled:!c,children:r("stage1:reset")})}),Object(l.jsx)(m.a,{children:Object(l.jsxs)(f.a,{variant:"outline-warning",className:"default-color-white float-right align-middle",onClick:me,disabled:!c,children:[Object(l.jsxs)("b",{children:[r("common:continue")," "]})," ",Object(l.jsx)(S.l,{})]})})]}),c&&p.progress<=K.TournamentProgress.PairsSelection?Object(l.jsxs)(l.Fragment,{children:[we,ke]}):null]}),Se={player1:r("pair:field.player1"),player2:r("pair:field.player2"),alias:r("pair:field.alias"),stage1:r("pair:field.stage1"),paid1:r("pair:field.paid1"),paid2:r("pair:field.paid2")};return Object(l.jsxs)("div",{children:[Object(l.jsx)(C.YesNoModal,{message:F.message,title:F.title,onClick:F.onClick,show:F.show}),Object(l.jsx)(C.LoadingModal,{show:N.state,message:N.message}),Object(l.jsxs)(m.a,{children:[Ce,Object(l.jsx)(j.a,{children:Object(l.jsx)(m.a,{children:_.rows&&_.players?Object(l.jsx)(g.a,{bootstrap4:!0,keyField:"id",data:_.rows,columns:M(je,_.players,Se),cellEdit:(xe=c&&p.progress<K.TournamentProgress.Stage1,P()({mode:xe?"click":"none",blurToSave:!0,afterSaveCell:function(e,t,r,a){"player1.alias"!==a.dataField&&"player2.alias"!==a.dataField&&Object(i.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/v1/pair",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});case 2:return t=e.sent,e.next=5,t.json();case 5:case"end":return e.stop()}}),e)})))()}})),selectRow:he,noDataIndication:function(){return Object(l.jsx)(k,{isEditable:c||!1,addRow:function(){return ue()},optionsLength:_.players.length})},caption:Object(l.jsx)(H.a,{}),headerClasses:"default-background default-color-yellow",striped:!0,hover:!0}):null})})]})]})}))},324:function(e,t,r){e.exports={functionsList:"common_functionsList__3B3UB",toolsBarContainer:"common_toolsBarContainer__1nanA",toolsBarRow:"common_toolsBarRow__r8q12"}},344:function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return c}));var a="auth:password.password",n="common:loading",c="tournament:select"},345:function(e,t,r){"use strict";var a=r(3),n=(r(0),r(75)),c=r(39),s=r(184),i=r(142),o=r(284),l=r(139),u=r(288);t.a=function(){var e=Object(c.d)(n.f.getTournament),t=Object(u.a)(["tournament"]).t;return Object(a.jsx)(s.a,{children:Object(a.jsx)(i.a,{children:Object(a.jsx)("h2",{className:"float-left",children:Object(a.jsxs)(o.a,{variant:"info",children:[Object(a.jsxs)("span",{children:[t("tournament:tournament")," "]}),Object(a.jsxs)("strong",{children:['"',e.name.toUpperCase(),'"']}),Object(a.jsx)("span",{children:Object(a.jsxs)("i",{children:[" - ".concat(Object(l.a)(e.date)," "),Object(a.jsxs)("small",{children:[" @ ",t("tournament:progress.".concat(e.progress))]})]})})]})})})})}}}]);
//# sourceMappingURL=7.49c97cf3.chunk.js.map
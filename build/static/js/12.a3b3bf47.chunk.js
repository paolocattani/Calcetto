(this.webpackJsonpcalcetto=this.webpackJsonpcalcetto||[]).push([[12],{273:function(e,t,n){e.exports={functionsList:"common_functionsList__3B3UB",toolsBarContainer:"common_toolsBarContainer__1nanA",toolsBarRow:"common_toolsBarRow__r8q12"}},370:function(e,t,n){"use strict";n.r(t);var a=n(125),r=n(19),o=n(0),c=n.n(o),l=n(37),u=n(88),i=n(273),s=n.n(i),d=n(126),m=n(131),f=n(167),p=n(106),g=n(17),b=n(128),h=n(29),v=n(8),w=n.n(v),O=n(20),S=n(282),N=n.n(S),j=n(274),y=n.n(j),E=function(e){var t=e.title,n=e.saved,a={color:n?"#4feb34":void 0};return c.a.createElement("h3",null,c.a.createElement("b",{style:a},"Girone - ",c.a.createElement("strong",null,t)),n?c.a.createElement("small",null," - Salvataggio in corso..."):null)};function C(e,t){return e.total===t.total?3===e["col".concat(t.rowNumber)]||2===e["col".concat(t.rowNumber)]?-1:1:t.total-e.total}var I=n(54),x=function(e){var t,n=e.rows,r=e.columns,i=e.tableName,s=e.updateCellValue,d=e.autoOrder,m=e.updatePlacement,f=e.saved,p=Object(l.b)(),v=Object(o.useState)([]),w=Object(a.a)(v,2),O=w[0],S=w[1],j=Object(l.c)(I.a.isAdmin),x=Object(l.c)(b.f.getTournament),k={mode:"checkbox",onSelect:function(e,t){console.log("handleOnSelect : ",e);var n,a=!!O.find((function(t){return t.rowNumber===e.rowNumber}));return n=t?a?O:[e].concat(Object(h.a)(O)):a?O.filter((function(t){return t.rowNumber!==e.rowNumber})):O,console.log("Selected : ",n),S(n),p(g.d.setSelectedPairs({stageName:i,rows:n})),!0},onSelectAll:function(e,t){S(e?t:[]),p(g.d.setSelectedPairs({stageName:i,rows:e?t:[]}))},style:{backgroundColor:"#c8e6c9"},hideSelectColumn:!j||x.progress>=u.TournamentProgress.Stage2};return console.log(" render : ",i,n),c.a.createElement(N.a,{key:"Stege1-".concat(i),bootstrap4:!0,keyField:"id",data:n,columns:r,selectRow:k,cellEdit:(t=j,y()({mode:t?"click":"none",blurToSave:!0,beforeSaveCell:function(e,t,a,r){r.id.startsWith("col")&&(n[parseInt(r.text)-1]["col".concat(a.rowNumber)]=function(e){if(null===e)return null;switch(parseInt(e)){case 3:return 0;case 2:return 1;case 1:return 2;case 0:return 3;default:return null}}(t))},afterSaveCell:function(e,t,a,r){if(r.id.startsWith("col")){s(e,t,a,r);var o=0;for(var c in a)c.startsWith("col")&&a[c]&&(o+=parseInt(a[c]));for(var l in n[a.rowNumber-1].total=o||0,console.log("Row : ",n[a.rowNumber-1]),o=0,n[parseInt(r.text)-1])l.startsWith("col")&&n[parseInt(r.text)-1][l]&&(o+=parseInt(n[parseInt(r.text)-1][l]));n[parseInt(r.text)-1].total=o||0,console.log("Opposite : ",n[parseInt(r.text)-1])}d&&Object(h.a)(n).sort((function(e,t){return C(e,t)})).forEach((function(e,t){return n[e.rowNumber-1].placement=t+1})),m(n)}})),noDataIndication:"Nessun dato reperito",headerClasses:"default-background default-color-yellow",caption:c.a.createElement(E,{title:i,saved:f}),striped:!0,hover:!0})},k=function(e,t){return{id:"col".concat(e),dataField:"col".concat(e),text:e.toString(),headerStyle:function(e,n){return{width:"".concat(75/t,"%")}},headerAlign:function(e,t){return"center"},editable:function(e,t,n,a){return n!==a-2},align:function(e,t,n,a){return"center"},style:function(e,t,n,a){return n===a-2?{backgroundColor:"#343a40"}:3===parseInt(e,10)||2===parseInt(e,10)?{backgroundColor:"rgb(196, 247, 160)"}:1===parseInt(e,10)||0===parseInt(e,10)?{backgroundColor:"rgb(255, 147, 147)"}:null},editor:{type:j.Type.SELECT,options:[{value:"3",label:"3"},{value:"2",label:"2"},{value:"1",label:"1"},{value:"0",label:"0"},{value:null,label:""}]}}},T=function(e){for(var t=[{id:"pairLabel",dataField:"pair.label",text:"Nome Coppia",editable:!1,headerStyle:function(e,t){return{width:"15%"}},align:function(e,t,n,a){return"center"},headerAlign:function(e,t){return"center"}},{id:"rowNumber",dataField:"rowNumber",text:"ID",editable:!1,type:"number",headerStyle:function(e,t){return{width:"5%"}},headerAlign:function(e,t){return"center"},style:function(e,t,n,a){return{backgroundColor:"#343a40",color:"#ffc107"}}}],n=0;n<e.length;n++)t.push(k(n+1,e.length));return t.push({id:"totale",dataField:"total",text:"Totale",editable:!1,type:"number",headerStyle:function(e,t){return{width:"5%"}},headerAlign:function(e,t){return"center"}},{id:"placement",dataField:"placement",text:"Posizione",editable:!0,type:"number",headerStyle:function(e,t){return{width:"5%"}},headerAlign:function(e,t){return"center"}}),t},P=function(e){var t,n,r=e.pairsList,l=e.autoOrder,u=Object(o.useState)(!1),i=Object(a.a)(u,2),s=i[0],d=i[1],m=Object(o.useState)(!1),f=Object(a.a)(m,2),p=f[0],g=f[1],b=Object(o.useState)(function(e){return e.map((function(t,n){for(var a={id:"row-".concat(t.tId,"-").concat(n),rowNumber:n+1,pair:t,total:0,placement:t.placement||0},r=1;r<=e.length;r++)a["col".concat(r)]=null;return a}))}(r)),v=Object(a.a)(b,2),S=v[0],N=v[1],j=null!==(t=null===(n=r[0])||void 0===n?void 0:n.stage1Name)&&void 0!==t?t:"Not found",y=function(){var e=Object(O.a)(w.a.mark((function e(t){var n,a;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.map((function(e){return{id:e.pair.id,placement:e.placement}})),e.next=3,fetch("/api/v1/stage1/placement",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({rows:n})});case 3:return a=e.sent,e.next=6,a.json();case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),E=function(){var e=Object(O.a)(w.a.mark((function e(t,n,a,r){var o,c;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={tId:a.pair.tId,tableName:j,score:n,pair1Id:a.pair.id,pair2Id:S[parseInt(r.text)-1].pair.id},console.log("updateCellValue : ",o),e.next=4,fetch("/api/v1/stage1/cell",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});case 4:return c=e.sent,e.next=7,c.json();case 7:c.ok&&(g(!0),setTimeout((function(){return g(!1)}),3e3));case 8:case"end":return e.stop()}}),e)})));return function(t,n,a,r){return e.apply(this,arguments)}}();return Object(o.useEffect)((function(){(function(){var e=Object(O.a)(w.a.mark((function e(){var t,n;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d(!0),e.next=3,fetch("/api/v1/stage1",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({rows:S,stageName:j})});case 3:return t=e.sent,e.next=6,t.json();case 6:n=e.sent,l&&Object(h.a)(n).sort((function(e,t){return C(e,t)})).forEach((function(e,t){return n[e.rowNumber-1].placement=t+1})),N(n),d(!1);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]),c.a.createElement(c.a.Fragment,null,s?c.a.createElement("h3",null,"Caricamento girone ",c.a.createElement("b",null,j)," in corso...."):c.a.createElement(x,{autoOrder:l,rows:S,columns:T(r),tableName:j,updateCellValue:E,updatePlacement:y,saved:p}))};t.default=Object(r.i)((function(){var e=Object(r.g)(),t=Object(l.b)(),n=Object(l.c)(b.c.getSession),i=Object(l.c)(b.f.getTournament,(function(e,t){return(null===e||void 0===e?void 0:e.progress)!==(null===t||void 0===t?void 0:t.progress)})),h=Object(l.c)(b.d.getNeedRefresh),v=Object(l.c)(b.d.getSelectedPairs),w=Object(l.c)(b.a.getPairsList),O=Object(o.useState)(!0),S=Object(a.a)(O,1)[0];return console.log("Refreshing : ",h),c.a.createElement(c.a.Fragment,null,c.a.createElement(m.a,{className:s.a.toolsBarContainer},c.a.createElement(f.a,{className:s.a.toolsBarRow},c.a.createElement(m.a,null,c.a.createElement(p.a,{variant:"secondary",onClick:function(){e.push(n.isAdmin?"/tournament":"/")},className:"float-left"},c.a.createElement(d.e,null)," Indietro")),c.a.createElement(m.a,null,c.a.createElement(p.a,{variant:"danger",onClick:function(){return t(g.e.delete.request({tId:i.id}))},disabled:!n.isAdmin||n.isAdmin&&i.progress<u.TournamentProgress.Stage2},c.a.createElement(d.l,null)," Reset Fase 2")),c.a.createElement(m.a,null,c.a.createElement(p.a,{variant:"outline-warning",className:"default-color-white float-right",onClick:function(){n.isAdmin&&i.progress<u.TournamentProgress.Stage2&&(i.progress=u.TournamentProgress.Stage2,t(g.f.updateTournament.request({model:i})));var a=0;if(w&&w.length>4)for(a=w.length-1;a%8!==0;)a++;t(g.e.fetchStage2.request({tournamentId:i.id,count:a})),e.push("/stage2")},disabled:v.length<4&&i.progress<u.TournamentProgress.Stage2},c.a.createElement("b",null,"Prosegui ")," ",c.a.createElement(d.g,null))))),w?function(e,t){var n="",a=[],r=[];e.sort((function(e,t){return e.stage1Name.localeCompare(t.stage1Name)})).forEach((function(e,o){""===n&&(n=e.stage1Name),n!==e.stage1Name&&(r.push(c.a.createElement(P,{key:"Stage1-".concat(n),pairsList:a,autoOrder:t})),n=e.stage1Name,a=[]),a.push(e)})),a.length>0&&r.push(c.a.createElement(P,{key:"Stage1-".concat(n),pairsList:a,autoOrder:t}));return r}(w,S):null)}))}}]);
//# sourceMappingURL=12.a3b3bf47.chunk.js.map
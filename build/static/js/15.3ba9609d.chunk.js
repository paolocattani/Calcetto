(this.webpackJsonpcalcetto=this.webpackJsonpcalcetto||[]).push([[15],{1274:function(e,t,a){"use strict";var n=a(3),r=a(9),c=a(12),o=a.n(c),s=a(0),i=a.n(s),l=a(102),u=function(){},d=i.a.forwardRef((function(e,t){var a=e.children,c=e.name,d=e.className,b=e.checked,j=e.type,f=e.onChange,p=e.value,O=e.disabled,h=e.inputRef,m=Object(r.a)(e,["children","name","className","checked","type","onChange","value","disabled","inputRef"]),g=Object(s.useState)(!1),x=g[0],v=g[1],N=Object(s.useCallback)((function(e){"INPUT"===e.target.tagName&&v(!0)}),[]),S=Object(s.useCallback)((function(e){"INPUT"===e.target.tagName&&v(!1)}),[]);return i.a.createElement(l.a,Object(n.a)({},m,{ref:t,className:o()(d,x&&"focus",O&&"disabled"),type:void 0,active:!!b,as:"label"}),i.a.createElement("input",{name:c,type:j,value:p,ref:h,autoComplete:"off",checked:!!b,disabled:!!O,onFocus:N,onBlur:S,onChange:f||u}),a)}));d.displayName="ToggleButton",t.a=d},1290:function(e,t,a){"use strict";a.r(t);var n=a(15),r=a(8),c=a(2),o=a(24),s=a(0),i=a(39),l=a(325),u=a.n(l),d=a(51),b=a(185),j=a(141),f=a(102),p=a(284),O=a(1274),h=a(13),m=a(75),g=a(4),x=a.n(g),v=a(20),N=a(292),S=a(396),w=a.n(S),y=a(361),C=a.n(y),k=function(e){var t=e.title,a=e.saved,n={color:a?"#4feb34":void 0};return Object(c.jsxs)("h3",{children:[Object(c.jsxs)("b",{style:n,children:["Girone - ",Object(c.jsx)("strong",{children:t})]}),a?Object(c.jsx)("small",{children:" - Salvataggio in corso..."}):null]})},T=a(152),I={headerAlign:"center"},P={align:"center"},B=function(e,t){return Object(r.a)(Object(r.a)(Object(r.a)({id:"col".concat(e),dataField:"col".concat(e),text:e.toString(),headerStyle:function(e,a){return{width:"".concat(75/t,"%")}}},I),{},{editable:function(e,t,a,n){return a!==n-2}},P),{},{style:function(e,t,a,n){return a===n-2?{backgroundColor:"#343a40"}:3===parseInt(e,10)||2===parseInt(e,10)?{backgroundColor:"rgb(196, 247, 160)"}:1===parseInt(e,10)||0===parseInt(e,10)?{backgroundColor:"rgb(255, 147, 147)"}:null},editor:{type:y.Type.SELECT,options:[{value:"3",label:"3"},{value:"2",label:"2"},{value:"1",label:"1"},{value:"0",label:"0"},{value:null,label:""}]}})},R=function(e){for(var t=[Object(r.a)(Object(r.a)({id:"pairLabel",dataField:"pair.label",text:"Nome Coppia",editable:!1,headerStyle:function(e,t){return{width:"15%"}}},P),I),Object(r.a)(Object(r.a)({id:"rowNumber",dataField:"rowNumber",text:"ID",editable:!1,type:"number",headerStyle:function(e,t){return{width:"5%"}}},I),{},{style:function(e,t,a,n){return{backgroundColor:"#343a40",color:"#ffc107"}}})],a=0;a<e.length;a++)t.push(B(a+1,e.length));return t.push(Object(r.a)({id:"totale",dataField:"total",text:"Totale",editable:!1,type:"number",headerStyle:function(e,t){return{width:"5%"}}},I),Object(r.a)({id:"placement",dataField:"placement",text:"Posizione",editable:!0,type:"number",headerStyle:function(e,t){return{width:"5%"}}},I)),t},q=a(71),A=a(59),E=function(e){var t=e.pairsList,a=e.autoOrder,r=Object(i.c)(),o=Object(i.d)(q.a.isAdmin),l=Object(i.d)(m.f.getTournament),u=Object(s.useState)([]),d=Object(N.a)(u,2),b=d[0],j=d[1],f=Object(s.useState)(!1),p=Object(N.a)(f,2),O=p[0],g=p[1],S=Object(s.useState)(!1),y=Object(N.a)(S,2),I=y[0],P=y[1],B=Object(s.useState)(Object(T.c)(t)),E=Object(N.a)(B,2),F=E[0],_=E[1],L=t[0].stage1Name;Object(s.useEffect)((function(){(function(){var e=Object(v.a)(x.a.mark((function e(){var t,r;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g(!0),e.next=3,fetch("/api/v1/stage1",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({rows:F,stageName:L})});case 3:return t=e.sent,e.next=6,t.json();case 6:r=e.sent,a&&Object(n.a)(r).sort((function(e,t){return Object(T.a)(e,t)})).forEach((function(e,t){return r[e.rowNumber-1].placement=t+1})),_(r),g(!1);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]);var U,J={mode:"checkbox",onSelect:function(e,t){var a,c=!!b.find((function(t){return t.rowNumber===e.rowNumber}));return a=t?c?b:[e].concat(Object(n.a)(b)):c?b.filter((function(t){return t.rowNumber!==e.rowNumber})):b,console.log("handleOnSelect : "),j(a),r(h.d.updateSelectedPairs.request({stageName:L,rows:a})),!0},onSelectAll:function(e,t){j(e?t:[]),r(h.d.updateSelectedPairs.request({stageName:L,rows:e?t:[]}))},style:{backgroundColor:"#c8e6c9"},hideSelectColumn:!o||l.progress>=A.TournamentProgress.Stage2};return O?Object(c.jsxs)("h3",{children:["Caricamento girone ",Object(c.jsx)("b",{children:L})," in corso...."]}):Object(c.jsx)(w.a,{bootstrap4:!0,keyField:"id",data:F,columns:R(t),selectRow:J,cellEdit:(U=o&&l.progress<A.TournamentProgress.Stage2,C()({mode:U?"click":"none",blurToSave:!0,beforeSaveCell:function(e,t,a,n){n.id.startsWith("col")&&(F[parseInt(n.text)-1]["col".concat(a.rowNumber)]=Object(T.b)(t))},afterSaveCell:function(){var e=Object(v.a)(x.a.mark((function e(t,c,o,s){var i,l,u,d,b,j,f,p,O;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=Object(n.a)(F),!s.id.startsWith("col")){e.next=20;break}return e.next=4,fetch("/api/v1/stage1/update/cell",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({tId:o.pair.tournamentId,tableName:L,score:c,pair1Id:o.pair.id,pair2Id:F[parseInt(s.text)-1].pair.id})});case 4:return l=e.sent,e.next=7,l.json();case 7:for(d in l.ok&&(P(!0),setTimeout((function(){return P(!1)}),3e3)),u=0,o)d.startsWith("col")&&o[d]&&(u+=parseInt(o[d]));for(p in b=o.rowNumber-1,(j=i[b]).total=u||0,u=0,f=parseInt(s.text)-1,i[f])p.startsWith("col")&&i[f][p]&&(u+=parseInt(i[f][p]));(O=i[f]).total=u||0,i.splice(b,1,j),i.splice(f,1,O);case 20:a&&Object(n.a)(i).sort((function(e,t){return Object(T.a)(e,t)})).forEach((function(e,t){return i[e.rowNumber-1].placement=t+1})),_(i),r(h.d.updatePlacement.request({rows:F.map((function(e){return{id:e.pair.id,placement:e.placement}}))}));case 23:case"end":return e.stop()}}),e)})));return function(t,a,n,r){return e.apply(this,arguments)}}()})),noDataIndication:"Nessun dato reperito",headerClasses:"default-background default-color-yellow",caption:Object(c.jsx)(k,{title:L,saved:I}),striped:!0,hover:!0},"Stege1-".concat(L))},F=a(346);t.default=Object(o.i)((function(){var e=Object(o.g)(),t=Object(i.c)(),a=Object(i.d)(m.a.getSession),n=Object(i.d)(m.f.getTournament),s=Object(i.d)(m.d.getNeedRefresh),l=Object(i.d)(m.d.getSelectedPairs),g=Object(i.d)(m.b.getPairsList);console.log("Refreshing : ",s);var x=Object(c.jsxs)("div",{className:u.a.toolsBarContainer,children:[Object(c.jsxs)(b.a,{className:u.a.toolsBarRow,children:[Object(c.jsx)(j.a,{children:Object(c.jsxs)(f.a,{variant:"secondary",onClick:function(){e.push(a.isAdmin?"/tournament":"/")},className:"float-left",children:[Object(c.jsx)(d.h,{})," Indietro"]})}),n.progress>A.TournamentProgress.Stage1?Object(c.jsx)(j.a,{children:Object(c.jsxs)(f.a,{variant:"danger",onClick:function(){return t(h.e.delete.request({tId:n.id}))},disabled:!a.isAdmin||a.isAdmin&&n.progress<A.TournamentProgress.Stage2,children:[Object(c.jsx)(d.q,{})," Reset Fase 2"]})}):null,Object(c.jsx)(j.a,{children:Object(c.jsxs)(f.a,{variant:"outline-warning",className:"default-color-white float-right",onClick:function(){a.isAdmin&&n.progress<A.TournamentProgress.Stage2&&(n.progress=A.TournamentProgress.Stage2,t(h.f.update.request({tournament:n})));var r=8;if(l&&l.length>=4)for(r=l.length-1;r%8!==0;)r++;t(h.e.fetchStage2.request({tournamentId:n.id,count:r})),e.push("/stage2")},disabled:l.length<4&&n.progress<A.TournamentProgress.Stage2,children:[Object(c.jsx)("b",{children:"Prosegui "})," ",Object(c.jsx)(d.l,{})]})})]}),Object(c.jsx)(b.a,{children:Object(c.jsx)(j.a,{children:Object(c.jsx)(p.a,{toggle:!0,className:"mb-2",children:Object(c.jsx)(O.a,{type:"checkbox",variant:n.autoOrder?"success":"danger",checked:n.autoOrder,value:"1",onChange:function(e){return t(h.f.update.request({tournament:Object(r.a)(Object(r.a)({},n),{},{autoOrder:e.currentTarget.checked})}))},children:"Ordinamento automatico : ".concat(n.autoOrder?"Attivato ":" Disattivato")})})})})]});return Object(c.jsxs)(c.Fragment,{children:[x,Object(c.jsx)(F.a,{}),g?_(g,n.autoOrder):null]})}));function _(e,t){var a="",r=[],o=[];return Object(n.a)(e).sort((function(e,t){return e.stage1Name.localeCompare(t.stage1Name)})).forEach((function(e,n){""===a&&(a=e.stage1Name),a!==e.stage1Name&&(o.push(Object(c.jsx)(E,{pairsList:r,autoOrder:t},"Stage1-".concat(a))),a=e.stage1Name,r=[]),r.push(e)})),r.length>0&&o.push(Object(c.jsx)(E,{pairsList:r,autoOrder:t},"Stage1-".concat(a))),o}},325:function(e,t,a){e.exports={functionsList:"common_functionsList__3B3UB",toolsBarContainer:"common_toolsBarContainer__1nanA",toolsBarRow:"common_toolsBarRow__r8q12"}},346:function(e,t,a){"use strict";var n=a(2),r=(a(0),a(75)),c=a(39),o=a(185),s=a(141),i=a(285),l=a(139),u=a(289);t.a=function(){var e=Object(c.d)(r.f.getTournament),t=Object(u.a)(["tournament"]).t;return Object(n.jsx)(o.a,{children:Object(n.jsx)(s.a,{children:Object(n.jsx)("h2",{className:"float-left",children:Object(n.jsxs)(i.a,{variant:"info",children:[Object(n.jsxs)("span",{children:[t("tournament:tournament")," "]}),Object(n.jsxs)("strong",{children:['"',e.name.toUpperCase(),'"']}),Object(n.jsx)("span",{children:Object(n.jsxs)("i",{children:[" - ".concat(Object(l.a)(e.date)," "),Object(n.jsxs)("small",{children:[" @ ",t("tournament:progress.".concat(e.progress))]})]})})]})})})})}}}]);
//# sourceMappingURL=15.3ba9609d.chunk.js.map
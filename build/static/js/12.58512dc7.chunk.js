(this.webpackJsonpcalcetto=this.webpackJsonpcalcetto||[]).push([[12],{273:function(e,t,a){e.exports={functionsList:"common_functionsList__3B3UB",toolsBarContainer:"common_toolsBarContainer__1nanA",toolsBarRow:"common_toolsBarRow__r8q12"}},370:function(e,t,a){"use strict";a.r(t);var n=a(125),r=a(19),o=a(0),c=a.n(o),l=a(37),s=a(88),i=a(273),u=a.n(i),d=a(126),m=a(131),b=a(167),f=a(106),p=a(16),g=a(127),h=a(8),j=a.n(h),O=a(14),v=a(21),w=a(282),S=a.n(w),N=a(274),E=a.n(N),y=function(e){var t=e.title,a=e.saved,n={color:a?"#4feb34":void 0};return c.a.createElement("h3",null,c.a.createElement("b",{style:n},"Girone - ",c.a.createElement("strong",null,t)),a?c.a.createElement("small",null," - Salvataggio in corso..."):null)};function k(e,t){return e.total===t.total?3===e["col".concat(t.rowNumber)]||2===e["col".concat(t.rowNumber)]?-1:1:t.total-e.total}var C=a(9),I={headerAlign:"center"},x={align:"center"},T=function(e,t){return Object(C.a)(Object(C.a)(Object(C.a)({id:"col".concat(e),dataField:"col".concat(e),text:e.toString(),headerStyle:function(e,a){return{width:"".concat(75/t,"%")}}},I),{},{editable:function(e,t,a,n){return a!==n-2}},x),{},{style:function(e,t,a,n){return a===n-2?{backgroundColor:"#343a40"}:3===parseInt(e,10)||2===parseInt(e,10)?{backgroundColor:"rgb(196, 247, 160)"}:1===parseInt(e,10)||0===parseInt(e,10)?{backgroundColor:"rgb(255, 147, 147)"}:null},editor:{type:N.Type.SELECT,options:[{value:"3",label:"3"},{value:"2",label:"2"},{value:"1",label:"1"},{value:"0",label:"0"},{value:null,label:""}]}})},P=function(e){for(var t=[Object(C.a)(Object(C.a)({id:"pairLabel",dataField:"pair.label",text:"Nome Coppia",editable:!1,headerStyle:function(e,t){return{width:"15%"}}},x),I),Object(C.a)(Object(C.a)({id:"rowNumber",dataField:"rowNumber",text:"ID",editable:!1,type:"number",headerStyle:function(e,t){return{width:"5%"}}},I),{},{style:function(e,t,a,n){return{backgroundColor:"#343a40",color:"#ffc107"}}})],a=0;a<e.length;a++)t.push(T(a+1,e.length));return t.push(Object(C.a)({id:"totale",dataField:"total",text:"Totale",editable:!1,type:"number",headerStyle:function(e,t){return{width:"5%"}}},I),Object(C.a)({id:"placement",dataField:"placement",text:"Posizione",editable:!0,type:"number",headerStyle:function(e,t){return{width:"5%"}}},I)),t},_=a(54),A=function(e){var t=e.pairsList,a=Object(l.b)(),r=Object(l.c)(_.a.isAdmin),i=Object(l.c)(g.f.getTournament),u=Object(o.useState)([]),d=Object(n.a)(u,2),m=d[0],b=d[1],f=Object(o.useState)(!1),h=Object(n.a)(f,2),w=h[0],N=h[1],C=Object(o.useState)(!1),I=Object(n.a)(C,2),x=I[0],T=I[1],A=Object(o.useState)(!0),B=Object(n.a)(A,1)[0],F=Object(o.useState)(function(e){return e.map((function(t,a){for(var n={id:"row-".concat(t.tId,"-").concat(a),rowNumber:a+1,pair:t,total:0,placement:t.placement||0},r=1;r<=e.length;r++)n["col".concat(r)]=null;return n}))}(t)),L=Object(n.a)(F,2),R=L[0],q=L[1],J=t[0].stage1Name;Object(o.useEffect)((function(){(function(){var e=Object(v.a)(j.a.mark((function e(){var t,a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return N(!0),e.next=3,fetch("/api/v1/stage1",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({rows:R,stageName:J})});case 3:return t=e.sent,e.next=6,t.json();case 6:a=e.sent,B&&Object(O.a)(a).sort((function(e,t){return k(e,t)})).forEach((function(e,t){return a[e.rowNumber-1].placement=t+1})),q(a),N(!1);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]);var W,D={mode:"checkbox",onSelect:function(e,t){var n,r=!!m.find((function(t){return t.rowNumber===e.rowNumber}));return n=t?r?m:[e].concat(Object(O.a)(m)):r?m.filter((function(t){return t.rowNumber!==e.rowNumber})):m,b(n),a(p.d.setSelectedPairs({stageName:J,rows:n})),!0},onSelectAll:function(e,t){b(e?t:[]),a(p.d.setSelectedPairs({stageName:J,rows:e?t:[]}))},style:{backgroundColor:"#c8e6c9"},hideSelectColumn:!r||i.progress>=s.TournamentProgress.Stage2};return console.log(" render : ",J,R),w?c.a.createElement("h3",null,"Caricamento girone ",c.a.createElement("b",null,J)," in corso...."):c.a.createElement(S.a,{key:"Stege1-".concat(J),bootstrap4:!0,keyField:"id",data:R,columns:P(t),selectRow:D,cellEdit:(W=r,E()({mode:W?"click":"none",blurToSave:!0,beforeSaveCell:function(e,t,a,n){n.id.startsWith("col")&&(R[parseInt(n.text)-1]["col".concat(a.rowNumber)]=function(e){if(null===e)return null;switch(parseInt(e)){case 3:return 0;case 2:return 1;case 1:return 2;case 0:return 3;default:return null}}(t))},afterSaveCell:function(){var e=Object(v.a)(j.a.mark((function e(t,n,r,o){var c,l,s,i,u,d,m,b,f;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=Object(O.a)(R),!o.id.startsWith("col")){e.next=20;break}return e.next=4,fetch("/api/v1/stage1/cell",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tId:r.pair.tId,tableName:J,score:n,pair1Id:r.pair.id,pair2Id:R[parseInt(o.text)-1].pair.id})});case 4:return l=e.sent,e.next=7,l.json();case 7:for(i in l.ok&&(T(!0),setTimeout((function(){return T(!1)}),3e3)),s=0,r)i.startsWith("col")&&r[i]&&(s+=parseInt(r[i]));for(b in u=r.rowNumber-1,(d=c[u]).total=s||0,s=0,m=parseInt(o.text)-1,c[m])b.startsWith("col")&&c[m][b]&&(s+=parseInt(c[m][b]));(f=c[m]).total=s||0,c.splice(u,1,d),c.splice(m,1,f);case 20:B&&Object(O.a)(c).sort((function(e,t){return k(e,t)})).forEach((function(e,t){return c[e.rowNumber-1].placement=t+1})),q(c),a(p.d.updatePlacement.request({rows:R.map((function(e){return{id:e.pair.id,placement:e.placement}}))}));case 23:case"end":return e.stop()}}),e)})));return function(t,a,n,r){return e.apply(this,arguments)}}()})),noDataIndication:"Nessun dato reperito",headerClasses:"default-background default-color-yellow",caption:c.a.createElement(y,{title:J,saved:x}),striped:!0,hover:!0})};t.default=Object(r.i)((function(){var e=Object(r.g)(),t=Object(l.b)(),a=Object(l.c)(g.c.getSession),i=Object(l.c)(g.f.getTournament,(function(e,t){return(null===e||void 0===e?void 0:e.progress)!==(null===t||void 0===t?void 0:t.progress)})),h=Object(l.c)(g.d.getNeedRefresh),j=Object(l.c)(g.d.getSelectedPairs),O=Object(l.c)(g.a.getPairsList),v=Object(o.useState)(!0);Object(n.a)(v,1)[0];return console.log("Refreshing : ",h),c.a.createElement(c.a.Fragment,null,c.a.createElement(m.a,{className:u.a.toolsBarContainer},c.a.createElement(b.a,{className:u.a.toolsBarRow},c.a.createElement(m.a,null,c.a.createElement(f.a,{variant:"secondary",onClick:function(){e.push(a.isAdmin?"/tournament":"/")},className:"float-left"},c.a.createElement(d.e,null)," Indietro")),c.a.createElement(m.a,null,c.a.createElement(f.a,{variant:"danger",onClick:function(){return t(p.e.delete.request({tId:i.id}))},disabled:!a.isAdmin||a.isAdmin&&i.progress<s.TournamentProgress.Stage2},c.a.createElement(d.l,null)," Reset Fase 2")),c.a.createElement(m.a,null,c.a.createElement(f.a,{variant:"outline-warning",className:"default-color-white float-right",onClick:function(){a.isAdmin&&i.progress<s.TournamentProgress.Stage2&&(i.progress=s.TournamentProgress.Stage2,t(p.f.updateTournament.request({model:i})));var n=0;if(O&&O.length>4)for(n=O.length-1;n%8!==0;)n++;t(p.e.fetchStage2.request({tournamentId:i.id,count:n})),e.push("/stage2")},disabled:j.length<4&&i.progress<s.TournamentProgress.Stage2},c.a.createElement("b",null,"Prosegui ")," ",c.a.createElement(d.g,null))))),O?function(e,t){var a="",n=[],r=[];e.sort((function(e,t){return e.stage1Name.localeCompare(t.stage1Name)})).forEach((function(e,t){""===a&&(a=e.stage1Name),a!==e.stage1Name&&(r.push(c.a.createElement(A,{key:"Stage1-".concat(a),pairsList:n})),a=e.stage1Name,n=[]),n.push(e)})),n.length>0&&r.push(c.a.createElement(A,{key:"Stage1-".concat(a),pairsList:n}));return r}(O):null)}))}}]);
//# sourceMappingURL=12.58512dc7.chunk.js.map
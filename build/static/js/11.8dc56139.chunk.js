(this.webpackJsonpcalcetto=this.webpackJsonpcalcetto||[]).push([[11],{260:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var a={isLoading:function(e){var t=e.tournamentState.isLoading;return t},getTournament:function(e){return e.tournamentState.tournament},getTournamentsList:function(e){return e.tournamentState.tournamentsList}}},268:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var a={isLoading:function(e){var t=e.stage1State.isLoading;return t},getSelectedRows:function(e){return e.stage1State.selectedRows||null},getSelectedPairs:function(e){return e.stage1State.selectedPairs},getNeedRefresh:function(e){return e.stage1State.needRefresh}}},282:function(e,t,n){e.exports={functionsList:"common_functionsList__3B3UB"}},364:function(e,t,n){"use strict";n.r(t);var a=n(122),r=n(0),o=n.n(r),c=n(18),u=n(30),i=n(7),l=n.n(i),s=n(23),d=n(272),f=n.n(d),m=n(263),p=n.n(m),g=function(e){var t=e.title,n=e.saved,a={color:n?"#4feb34":void 0};return o.a.createElement("h3",null,o.a.createElement("b",{style:a},"Girone - ",o.a.createElement("strong",null,t)),n?o.a.createElement("small",null," - Salvataggio in corso..."):null)};function b(e,t){return e.total===t.total?3===e["col".concat(t.rowNumber)]||2===e["col".concat(t.rowNumber)]?-1:1:t.total-e.total}var h=n(29),v=n(43),S=n(17),w=function(e){var t,n=e.rows,c=e.columns,i=e.tableName,l=e.updateCellValue,s=e.autoOrder,d=e.updatePlacement,m=e.saved,w=Object(h.c)(),O=Object(r.useState)([]),j=Object(a.a)(O,2),N=j[0],E=j[1],y=Object(h.d)(v.a.getSession),I={mode:"checkbox",onSelect:function(e,t){console.log("handleOnSelect : ",e);var n,a=!!N.find((function(t){return t.rowNumber===e.rowNumber}));return n=t?a?N:[e].concat(Object(u.a)(N)):a?N.filter((function(t){return t.rowNumber!==e.rowNumber})):N,console.log("Selected : ",n),E(n),w(S.c.setSelectedPairs({stageName:i,rows:n})),!0},onSelectAll:function(e,t){E(e?t:[]),w(S.c.setSelectedPairs({stageName:i,rows:e?t:[]}))},style:{backgroundColor:"#c8e6c9"}};return console.log(" render : ",i,n),o.a.createElement(f.a,{bootstrap4:!0,keyField:"id",data:n,columns:c,selectRow:I,cellEdit:(t=y.isAdmin,p()({mode:t?"click":"none",blurToSave:!0,beforeSaveCell:function(e,t,a,r){r.id.startsWith("col")&&(n[parseInt(r.text)-1]["col".concat(a.rowNumber)]=function(e){if(null===e)return null;switch(parseInt(e)){case 3:return 0;case 2:return 1;case 1:return 2;case 0:return 3;default:return null}}(t))},afterSaveCell:function(e,t,a,r){if(r.id.startsWith("col")){l(e,t,a,r);var o=0;for(var c in a)c.startsWith("col")&&a[c]&&(o+=parseInt(a[c]));for(var i in n[a.rowNumber-1].total=o||0,console.log("Row : ",n[a.rowNumber-1]),o=0,n[parseInt(r.text)-1])i.startsWith("col")&&n[parseInt(r.text)-1][i]&&(o+=parseInt(n[parseInt(r.text)-1][i]));n[parseInt(r.text)-1].total=o||0,console.log("Opposite : ",n[parseInt(r.text)-1])}s&&Object(u.a)(n).sort((function(e,t){return b(e,t)})).forEach((function(e,t){return n[e.rowNumber-1].placement=t+1})),d(n)}})),noDataIndication:"Nessun dato reperito",headerClasses:"default-background default-color-yellow",caption:o.a.createElement(g,{title:i,saved:m}),striped:!0,hover:!0})},O=function(e,t){return{id:"col".concat(e),dataField:"col".concat(e),text:e.toString(),headerStyle:function(e,n){return{width:"".concat(75/t,"%")}},headerAlign:function(e,t){return"center"},editable:function(e,t,n,a){return n!==a-2},align:function(e,t,n,a){return"center"},style:function(e,t,n,a){return n===a-2?{backgroundColor:"#343a40"}:3===parseInt(e,10)||2===parseInt(e,10)?{backgroundColor:"rgb(196, 247, 160)"}:1===parseInt(e,10)||0===parseInt(e,10)?{backgroundColor:"rgb(255, 147, 147)"}:null},editor:{type:m.Type.SELECT,options:[{value:"3",label:"3"},{value:"2",label:"2"},{value:"1",label:"1"},{value:"0",label:"0"},{value:null,label:""}]}}},j=function(e){for(var t=[{id:"pairLabel",dataField:"pair.label",text:"Nome Coppia",editable:!1,headerStyle:function(e,t){return{width:"15%"}},align:function(e,t,n,a){return"center"},headerAlign:function(e,t){return"center"}},{id:"rowNumber",dataField:"rowNumber",text:"ID",editable:!1,type:"number",headerStyle:function(e,t){return{width:"5%"}},headerAlign:function(e,t){return"center"},style:function(e,t,n,a){return{backgroundColor:"#343a40",color:"#ffc107"}}}],n=0;n<e.length;n++)t.push(O(n+1,e.length));return t.push({id:"totale",dataField:"total",text:"Totale",editable:!1,type:"number",headerStyle:function(e,t){return{width:"5%"}},headerAlign:function(e,t){return"center"}},{id:"placement",dataField:"placement",text:"Posizione",editable:!0,type:"number",headerStyle:function(e,t){return{width:"5%"}},headerAlign:function(e,t){return"center"}}),t},N=function(e){var t,n,c=e.pairsList,i=e.autoOrder,d=Object(r.useState)(!1),f=Object(a.a)(d,2),m=f[0],p=f[1],g=Object(r.useState)(!1),h=Object(a.a)(g,2),v=h[0],S=h[1],O=Object(r.useState)(function(e){return e.map((function(t,n){for(var a={id:"row-".concat(t.tId,"-").concat(n),rowNumber:n+1,pair:t,total:0,placement:t.placement||0},r=1;r<=e.length;r++)a["col".concat(r)]=null;return a}))}(c)),N=Object(a.a)(O,2),E=N[0],y=N[1],I=null!==(t=null===(n=c[0])||void 0===n?void 0:n.stage1Name)&&void 0!==t?t:"Not found",x=function(){var e=Object(s.a)(l.a.mark((function e(t){var n,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.map((function(e){return{id:e.pair.id,placement:e.placement}})),e.next=3,fetch("/api/v1/stage1/placement",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({rows:n})});case 3:return a=e.sent,e.next=6,a.json();case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),k=function(){var e=Object(s.a)(l.a.mark((function e(t,n,a,r){var o,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={tId:a.pair.tId,tableName:I,score:n,pair1Id:a.pair.id,pair2Id:E[parseInt(r.text)-1].pair.id},e.next=3,fetch("/api/v1/stage1/cell",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});case 3:return c=e.sent,e.next=6,c.json();case 6:c.ok&&(S(!0),setTimeout((function(){return S(!1)}),3e3));case 7:case"end":return e.stop()}}),e)})));return function(t,n,a,r){return e.apply(this,arguments)}}();return Object(r.useEffect)((function(){(function(){var e=Object(s.a)(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p(!0),e.next=3,fetch("/api/v1/stage1",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({rows:E,stageName:I})});case 3:return t=e.sent,e.next=6,t.json();case 6:n=e.sent,i&&Object(u.a)(n).sort((function(e,t){return b(e,t)})).forEach((function(e,t){return n[e.rowNumber-1].placement=t+1})),y(n),p(!1);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]),o.a.createElement(o.a.Fragment,null,m?o.a.createElement("h3",null,"Caricamento girone ",o.a.createElement("b",null,I)," in corso...."):o.a.createElement(w,{autoOrder:i,rows:E,columns:j(c),tableName:I,updateCellValue:k,updatePlacement:x,saved:v}))},E=n(358),y=n(101),I=n(127),x=n(129),k=n(260),C=n(268),T=n(282),P=n.n(T),L=n(51),F=function(e){var t=e.title,n=e.show,a=e.onHide,r=e.component,c=e.size,u=n;return a||(a=function(){return u=!1}),o.a.createElement(L.a,{show:u,onHide:a,size:c||"lg",centered:!0},o.a.createElement(L.a.Header,{closeButton:!0},o.a.createElement(L.a.Title,null,t)),o.a.createElement(L.a.Body,null,r))};t.default=Object(c.i)((function(){var e=Object(c.g)(),t=Object(h.c)(),n=Object(h.d)(v.a.getSession),u=Object(h.d)(k.a.getTournament),i=Object(h.d)(C.a.getNeedRefresh),l=Object(h.d)(C.a.getSelectedPairs),s=Object(r.useState)([]),d=Object(a.a)(s,2),f=d[0],m=d[1],p=Object(r.useState)(!0),g=Object(a.a)(p,1)[0],b={show:!1,message:""},w=Object(r.useState)(b),O=Object(a.a)(w,2),j=O[0],T=O[1];return Object(r.useEffect)((function(){f&&0!==f.length&&!i||Object(I.c)(m,u.id)}),[u.id,i,f]),o.a.createElement(o.a.Fragment,null,o.a.createElement(E.a.Item,{className:P.a.functionsList,key:"stage-button"},o.a.createElement(y.a,{variant:"secondary",onClick:function(){e.push("/tournament")}},"Gestione Coppie"),o.a.createElement(y.a,{variant:"secondary",onClick:function(){return t(S.d.delete.request({tId:u.id}))}},"Reset Fase 2"),o.a.createElement(y.a,{variant:"success",className:"float-right",onClick:function(){n.isAdmin&&u.progress<x.TournamentProgress.Stage2&&(u.progress=x.TournamentProgress.Stage2,t(S.e.updateTournament.request({model:u})));var a=0;if(f.length>4)for(a=f.length-1;a%8!==0;)a++;t(S.d.fetchStage2.request({tournamentId:u.id,count:a})),e.push("/stage2")},disabled:l.length<4&&u.progress<x.TournamentProgress.Stage2},u.progress," - Prosegui")),o.a.createElement(F,{show:j.show,title:"Errore",onHide:function(){return T(b)},component:o.a.createElement("p",null,j.message),size:"xl"}),function(e,t){var n="",a=[],r=[];console.log("PairsList : ",e),e.sort((function(e,t){return e.stage1Name.localeCompare(t.stage1Name)})).forEach((function(e,c){""===n&&(n=e.stage1Name),n!==e.stage1Name&&(r.push(o.a.createElement(E.a.Item,{className:"inherit-background",key:"stage-".concat(n)},o.a.createElement(N,{pairsList:a,autoOrder:t}))),n=e.stage1Name,a=[]),a.push(e)})),a.length>0&&r.push(o.a.createElement(E.a.Item,{className:"inherit-background",key:"stage-".concat(n)},o.a.createElement(N,{pairsList:a,autoOrder:t})));return o.a.createElement(E.a,{variant:"flush"},r)}(f,g))}))}}]);
//# sourceMappingURL=11.8dc56139.chunk.js.map